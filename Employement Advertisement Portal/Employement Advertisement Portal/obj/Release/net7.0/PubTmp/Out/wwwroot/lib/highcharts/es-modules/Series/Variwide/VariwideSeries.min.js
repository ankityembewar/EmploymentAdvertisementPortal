"use strict";import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";const ColumnSeries=SeriesRegistry.seriesTypes["column"];import VariwideComposition from"./VariwideComposition.js";import VariwidePoint from"./VariwidePoint.js";import VariwideSeriesDefaults from"./VariwideSeriesDefaults.js";import U from"../../Core/Utilities.js";const{addEvent,extend,merge,pick}=U;class VariwideSeries extends ColumnSeries{processData(i){this.totalZ=0,this.relZ=[],SeriesRegistry.seriesTypes.column.prototype.processData.call(this,i),(this.xAxis.reversed?this.zData.slice().reverse():this.zData).forEach(function(i,t){this.relZ[t]=this.totalZ,this.totalZ+=i},this),this.xAxis.categories&&(this.xAxis.variwide=!0,this.xAxis.zData=this.zData)}postTranslate(i,t,e){const s=this.xAxis,r=this.relZ,a=s.reversed?r.length-i:i,o=s.reversed?-1:1,n=s.toPixels(s.reversed?(s.dataMax||0)+s.pointRange:s.dataMin||0),h=s.toPixels(s.reversed?s.dataMin||0:(s.dataMax||0)+s.pointRange),d=Math.abs(h-n),p=this.totalZ,l=this.chart.inverted?h-(this.chart.plotTop-o*s.minPixelPadding):n-this.chart.plotLeft-o*s.minPixelPadding,c=a/r.length*d,x=(a+o)/r.length*d,m=pick(r[a],p)/p*d,w=pick(r[a+o],p)/p*d,S=t-(l+c);return e&&(e.crosshairWidth=w-m),l+m+S*(w-m)/(x-c)}translate(){this.crispOption=this.options.crisp,this.options.crisp=!1,super.translate(),this.options.crisp=this.crispOption}correctStackLabels(){var i=this,t=i.options,e=i.yAxis;let s,r,a,o;for(const n of i.points)o=n.x,r=n.shapeArgs.width,(a=e.stacking.stacks[(i.negStacks&&n.y<(t.startFromThreshold?0:t.threshold)?"-":"")+i.stackKey])&&(s=a[o])&&!n.isNull&&s.setOffset(-r/2||0,r||0,void 0,void 0,n.plotX,i.xAxis)}}VariwideSeries.compose=VariwideComposition.compose,VariwideSeries.defaultOptions=merge(ColumnSeries.defaultOptions,VariwideSeriesDefaults),addEvent(VariwideSeries,"afterColumnTranslate",function(){const e=this.xAxis,s=this.chart.inverted,r=this.borderWidth%2/2;let a=-1;for(const o of this.points){++a;const n=o.shapeArgs||{},{x:h=0,width:d=0}=n,{plotX:p=0,tooltipPos:l,z:c=0}=o;let i,t;t=e.variwide?(i=this.postTranslate(a,h,o),this.postTranslate(a,h+d)):(i=p,e.translate(o.x+c,!1,!1,!1,!0)),this.crispOption&&(i=Math.round(i)-r,t=Math.round(t)-r),n.x=i,n.width=Math.max(t-i,1),o.plotX=(i+t)/2,l&&(s?l[1]=e.len-n.x-n.width/2:l[0]=n.x+n.width/2)}this.options.stacking&&this.correctStackLabels()},{order:2}),extend(VariwideSeries.prototype,{irregularWidths:!0,pointArrayMap:["y","z"],parallelArrays:["x","y","z"],pointClass:VariwidePoint}),SeriesRegistry.registerSeriesType("variwide",VariwideSeries);export default VariwideSeries;