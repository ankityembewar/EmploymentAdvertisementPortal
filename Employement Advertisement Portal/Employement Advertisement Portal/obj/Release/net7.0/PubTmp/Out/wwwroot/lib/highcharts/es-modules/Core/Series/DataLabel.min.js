"use strict";import A from"../Animation/AnimationUtilities.js";const getDeferredAnimation=A["getDeferredAnimation"];import F from"../Templating.js";const format=F["format"];import U from"../Utilities.js";const{defined,extend,fireEvent,isArray,isString,merge,objectEach,pick,pInt,splat}=U;var DataLabel;!function(){function i(){return l(this).some(t=>t?.enabled)}function e(t,a,i,e,o){const r=this,n=this.chart,s=this.isCartesian&&n.inverted,d=this.enabledDataSorting,l=t.plotX,h=t.plotY,c=i.rotation||0,p=defined(l)&&defined(h)&&n.isInsidePlot(l,Math.round(h),{inverted:s,paneCoordinates:!0,series:r}),g=0===c&&"justify"===pick(i.overflow,d?"none":"justify");let f=this.visible&&!1!==t.visible&&defined(l)&&(t.series.forceDL||d&&!g||p||pick(i.inside,!!this.options.stacking)&&e&&n.isInsidePlot(l,s?e.x+1:e.y+e.height-1,{inverted:s,paneCoordinates:!0,series:r}));var b,u,m,y,v,L=t.pos();f&&L&&(b=a.getBBox(),u=a.getBBox(void 0,0),m={right:1,center:.5}[i.align||0]||0,y={bottom:1,middle:.5}[i.verticalAlign||0]||0,e=extend({x:L[0],y:Math.round(L[1]),width:0,height:0},e||{}),extend(i,{width:b.width,height:b.height}),v=e,d&&r.xAxis&&!g&&r.setDataLabelStartPos(t,a,o,p,v),a.align(merge(i,{width:u.width,height:u.height}),!1,e,!1),a.alignAttr.x+=m*(u.width-b.width),a.alignAttr.y+=y*(u.height-b.height),a[a.placed?"animate":"attr"]({x:a.alignAttr.x+(b.width-u.width)/2,y:a.alignAttr.y+(b.height-u.height)/2,rotationOriginX:(a.width||0)/2,rotationOriginY:(a.height||0)/2}),g&&0<=e.height?this.justifyDataLabel(a,i,a.alignAttr,b,e,o):pick(i.crop,!0)&&({x:t,y:v}=a.alignAttr,f=n.isInsidePlot(t,v,{paneCoordinates:!0,series:r})&&n.isInsidePlot(t+b.width-1,v+b.height-1,{paneCoordinates:!0,series:r})),i.shape&&!c&&a[o?"attr":"animate"]({anchorX:L[0],anchorY:L[1]})),o&&d&&(a.placed=!1),f||d&&!g?(a.show(),a.placed=!0):(a.hide(),a.placed=!1)}function o(){return this.plotGroup("dataLabelsGroup","data-labels",this.hasRendered?"inherit":"hidden",this.options.dataLabels.zIndex||6)}function r(t){var a=this,i=a.hasRendered||0;const e=this.initDataLabelsGroup().attr({opacity:+i});return!i&&e&&(a.visible&&e.show(),a.options.animation?e.animate({opacity:1},t):e.attr({opacity:1})),e}function n(t){t=t||this.points;const L=this,x=L.chart,A=L.options,D=x.renderer,{backgroundColor:a,plotBackgroundColor:i}=x.options.chart,w=D.getContrast(isString(i)&&i||isString(a)&&a||"#000000"),e=l(L);let o,P;var{animation:r,defer:n}=e[0],n=n?getDeferredAnimation(x,r,L):{defer:0,duration:0};fireEvent(this,"drawDataLabels"),L.hasDataLabels?.()&&(P=this.initDataLabels(n),t.forEach(y=>{const v=y.dataLabels||[];(o=splat(d(e,y.dlOptions||y.options?.dataLabels))).forEach((t,a)=>{const i=t.enabled&&(y.visible||y.dataLabelOnHidden)&&(!y.isNull||y.dataLabelOnNull)&&(s=y,!(d=(d=t).filter)||(l=d.operator,s=s[d.property],d=d.value,">"===l&&d<s||"<"===l&&s<d||">="===l&&d<=s||"<="===l&&s<=d||"=="===l&&s==d||"==="===l&&s===d||"!="===l&&s!=d||"!=="===l&&s!==d)),{backgroundColor:e,borderColor:o,distance:r,style:n={}}=t;var s,d,l;let h,c,p,g,f={},b=v[a],u=!b,m;i&&(c=pick(t[y.formatPrefix+"Format"],t.format),h=y.getLabelConfig(),p=defined(c)?format(c,h,x):(t[y.formatPrefix+"Formatter"]||t.formatter).call(h,t),g=t.rotation,x.styledMode||(n.color=pick(t.color,n.color,isString(L.color)?L.color:void 0,"#000000"),"contrast"===n.color?("none"!==e&&(m=e),y.contrastColor=D.getContrast("auto"!==m&&m||y.color||L.color),n.color=m||!defined(r)&&t.inside||pInt(r||0)<0||A.stacking?y.contrastColor:w):delete y.contrastColor,A.cursor&&(n.cursor=A.cursor)),f={r:t.borderRadius||0,rotation:g,padding:t.padding,zIndex:1},x.styledMode||(f.fill="auto"===e?y.color:e,f.stroke="auto"===o?y.color:o,f["stroke-width"]=t.borderWidth),objectEach(f,(t,a)=>{void 0===t&&delete f[a]})),!b||i&&defined(p)&&!!b.div==!!t.useHTML&&(b.rotation&&t.rotation||b.rotation===t.rotation)||(b=void 0,u=!0),i&&defined(p)&&(b?f.text=p:(b=D.label(p,0,0,t.shape,void 0,void 0,t.useHTML,void 0,"data-label")).addClass(" highcharts-data-label-color-"+y.colorIndex+" "+(t.className||"")+(t.useHTML?" highcharts-tracker":"")),b&&(b.options=t,b.attr(f),x.styledMode||b.css(n).shadow(t.shadow),(l=t[y.formatPrefix+"TextPath"]||t.textPath)&&!t.useHTML&&(b.setTextPath(y.getDataLabelPath?.(b)||y.graphic,l),y.dataLabelPath&&!l.enabled&&(y.dataLabelPath=y.dataLabelPath.destroy())),b.added||b.add(P),L.alignDataLabel(y,b,t,void 0,u),b.isActive=!0,v[a]&&v[a]!==b&&v[a].destroy(),v[a]=b))});let t=v.length;for(;t--;)v[t]&&v[t].isActive?v[t].isActive=!1:(v[t]?.destroy(),v.splice(t,1));y.dataLabel=v[0],y.dataLabels=v})),fireEvent(this,"afterDrawDataLabels")}function s(t,a,i,e,o,r){var n=this.chart,s=a.align,d=a.verticalAlign,l=!t.box&&t.padding||0;let{x:h=0,y:c=0}=a,p,g;return(p=(i.x||0)+l)<0&&("right"===s&&0<=h?(a.align="left",a.inside=!0):h-=p,g=!0),(p=(i.x||0)+e.width-l)>n.plotWidth&&("left"===s&&h<=0?(a.align="right",a.inside=!0):h+=n.plotWidth-p,g=!0),(p=i.y+l)<0&&("bottom"===d&&0<=c?(a.verticalAlign="top",a.inside=!0):c-=p,g=!0),(p=(i.y||0)+e.height-l)>n.plotHeight&&("top"===d&&c<=0?(a.verticalAlign="bottom",a.inside=!0):c+=n.plotHeight-p,g=!0),g&&(a.x=h,a.y=c,t.placed=!r,t.align(a,void 0,o)),g}function d(a,i){let t=[],e;if(isArray(a)&&!isArray(i))t=a.map(function(t){return merge(t,i)});else if(isArray(i)&&!isArray(a))t=i.map(function(t){return merge(a,t)});else if(isArray(a)||isArray(i)){if(isArray(a)&&isArray(i))for(e=Math.max(a.length,i.length);e--;)t[e]=merge(a[e],i[e])}else t=merge(a,i);return t}function l(t){var a=t.chart.options.plotOptions;return splat(d(d(a?.series?.dataLabels,a?.[t.type]?.dataLabels),t.options.dataLabels))}function h(t,a,i,e,o){var r=this.chart,n=r.inverted,s=this.xAxis,d=s.reversed,l=((n?a.height:a.width)||0)/2,t=t.pointWidth,t=t?t/2:0;a.startXPos=n?o.x:d?-l-t:s.width-l+t,a.startYPos=n?d?this.yAxis.height-l+t:-l-t:o.y,e?"hidden"===a.visibility&&(a.show(),a.attr({opacity:0}).animate({opacity:1})):a.attr({opacity:1}).animate({opacity:0},void 0,a.hide),r.hasRendered&&(i&&a.attr({x:a.startXPos,y:a.startYPos}),a.placed=!0)}(DataLabel||(DataLabel={})).compose=function(t){const a=t.prototype;a.initDataLabels||(a.initDataLabels=r,a.initDataLabelsGroup=o,a.alignDataLabel=e,a.drawDataLabels=n,a.justifyDataLabel=s,a.setDataLabelStartPos=h,a.hasDataLabels=i)}}();export default DataLabel;