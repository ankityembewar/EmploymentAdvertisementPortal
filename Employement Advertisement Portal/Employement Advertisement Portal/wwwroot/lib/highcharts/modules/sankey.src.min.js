!function(o){"object"==typeof module&&module.exports?module.exports=o.default=o:"function"==typeof define&&define.amd?define("highcharts/modules/sankey",["highcharts"],function(t){return o(t),o.Highcharts=t,o}):o("undefined"!=typeof Highcharts?Highcharts:void 0)}(function(t){"use strict";t=t?t._modules:{};function o(t,o,e,i){t.hasOwnProperty(o)||(t[o]=i.apply(null,e),"function"==typeof CustomEvent&&window.dispatchEvent(new CustomEvent("HighchartsModuleLoaded",{detail:{path:o,module:t[o]}})))}o(t,"Series/NodesComposition.js",[t["Core/Series/SeriesRegistry.js"],t["Core/Utilities.js"]],function(t,o){const{prototype:i,prototype:{pointClass:{prototype:a}}}=t["series"],{defined:s,extend:r,find:l,merge:d,pick:h}=o;var e;function n(){return this.data=[].concat(this.points||[],this.nodes),i.destroy.apply(this,arguments)}function p(){this.nodes&&(this.nodes.forEach(t=>{t.destroy()}),this.nodes.length=0),i.setData.apply(this,arguments)}function c(t){const o=arguments,e=this.isNode?this.linksTo.concat(this.linksFrom):[this.fromNode,this.toNode];"select"!==t&&e.forEach(t=>{t&&t.series&&(a.setState.apply(t,o),t.isNode||(t.fromNode.graphic&&a.setState.apply(t.fromNode,o),t.toNode&&t.toNode.graphic&&a.setState.apply(t.toNode,o)))}),a.setState.apply(this,o)}function u(t,o,e,i){const s=this.series.options.nodes,n=this.series.options.data,r=n&&n.length||0,l=n&&n[this.index];a.update.call(this,t,!this.isNode&&o,e,i),this.isNode&&(t=(s||[]).reduce((t,o,e)=>this.id===o.id?e:t,-1),i=d(s&&s[t]||{},n&&n[this.index]||{}),n&&(l?n[this.index]=l:n.length=r),s?0<=t?s[t]=i:s.push(i):this.series.options.nodes=[i],h(o,!0)&&this.series.chart.redraw(e))}return(t=e=e||{}).compose=function(t,o){const e=t.prototype,i=o.prototype;return e.setNodeState=c,e.setState=c,e.update=u,i.destroy=n,i.setData=p,o},t.createNode=function(t){const o=this.pointClass,e=(t,o)=>l(t,t=>t.id===o);let i=e(this.nodes,t),s;if(!i){s=this.options.nodes&&e(this.options.nodes,t);const n=new o(this,r({className:"highcharts-node",isNode:!0,id:t,y:1},s));n.linksTo=[],n.linksFrom=[],n.getSum=function(){let o=0,e=0;return n.linksTo.forEach(t=>{o+=t.weight||0}),n.linksFrom.forEach(t=>{e+=t.weight||0}),Math.max(o,e)},n.offset=function(o,e){let i=0;for(let t=0;t<n[e].length;t++){if(n[e][t]===o)return i;i+=n[e][t].weight}},n.hasShape=function(){let o=0;return n.linksTo.forEach(t=>{t.outgoing&&o++}),!n.linksTo.length||o!==n.linksTo.length},n.index=this.nodes.push(n)-1,i=n}return i.formatPrefix="node",i.name=i.name||i.options.id||"",i.mass=h(i.options.mass,i.options.marker&&i.options.marker.radius,this.options.marker&&this.options.marker.radius,4),i},t.destroy=n,t.generatePoints=function(){const o=this.chart,e={};i.generatePoints.call(this),this.nodes||(this.nodes=[]),this.colorCounter=0,this.nodes.forEach(t=>{t.linksFrom.length=0,t.linksTo.length=0,t.level=t.options.level}),this.points.forEach(t=>{s(t.from)&&(e[t.from]||(e[t.from]=this.createNode(t.from)),e[t.from].linksFrom.push(t),t.fromNode=e[t.from],o.styledMode?t.colorIndex=h(t.options.colorIndex,e[t.from].colorIndex):t.color=t.options.color||e[t.from].color),s(t.to)&&(e[t.to]||(e[t.to]=this.createNode(t.to)),e[t.to].linksTo.push(t),t.toNode=e[t.to]),t.name=t.name||t.id},this),this.nodeLookup=e},t.setNodeState=c,t.updateNode=u,e}),o(t,"Series/Sankey/SankeyPoint.js",[t["Core/Series/Point.js"],t["Core/Series/SeriesRegistry.js"],t["Core/Utilities.js"]],function(e,t,o){t=t.seriesTypes.column;const i=o["defined"];class s extends t.prototype.pointClass{applyOptions(t,o){return e.prototype.applyOptions.call(this,t,o),i(this.options.level)&&(this.options.column=this.column=this.options.level),this}getClassName(){return(this.isNode?"highcharts-node ":"highcharts-link ")+e.prototype.getClassName.call(this)}getFromNode(){let o=-1,e;for(let t=0;t<this.linksTo.length;t++){var i=this.linksTo[t];i.fromNode.column>o&&i.fromNode!==this&&(e=i.fromNode,o=e.column)}return{fromNode:e,fromColumn:o}}setNodeColumn(){var t=this;i(t.options.column)||(0===t.linksTo.length?t.column=0:t.column=t.getFromNode().fromColumn+1)}isValid(){return this.isNode||"number"==typeof this.weight}}return s}),o(t,"Series/Sankey/SankeySeriesDefaults.js",[],function(){return{borderWidth:0,colorByPoint:!0,curveFactor:.33,dataLabels:{enabled:!0,backgroundColor:"none",crop:!1,nodeFormat:void 0,nodeFormatter:function(){return this.point.name},format:void 0,formatter:function(){},inside:!0},inactiveOtherPoints:!0,linkColorMode:"from",linkOpacity:.5,opacity:1,minLinkWidth:0,nodeAlignment:"center",nodeWidth:20,nodePadding:10,nodeDistance:30,showInLegend:!1,states:{hover:{linkOpacity:1,opacity:1},inactive:{linkOpacity:.1,opacity:.1,animation:{duration:50}}},tooltip:{followPointer:!0,headerFormat:'<span style="font-size: 0.8em">{series.name}</span><br/>',pointFormat:"{point.fromNode.name} â†’ {point.toNode.name}: <b>{point.weight}</b><br/>",nodeFormat:"{point.name}: <b>{point.sum}</b><br/>"}}}),o(t,"Series/Sankey/SankeyColumnComposition.js",[t["Core/Utilities.js"]],function(t){const{defined:c,relativeLength:u}=t;var o;{(t=o=o||{}).compose=function(t,o){const e=t;return e.sankeyColumn=new i(e,o),e};class i{constructor(t,o){this.points=t,this.series=o}getTranslationFactor(t){const o=this.points,e=o.slice(),i=t.chart,s=t.options.minLinkWidth||0;let n,r=0,l,a=(i.plotSizeY||0)-(t.options.borderWidth||0)-(o.length-1)*t.nodePadding;for(;o.length;){for(r=a/o.sankeyColumn.sum(),n=!1,l=o.length;l--;)o[l].getSum()*r<s&&(o.splice(l,1),a=Math.max(0,a-s),n=!0);if(!n)break}o.length=0;for(const d of e)o.push(d);return r}top(e){const i=this.series,s=i.nodePadding,t=this.points.reduce((t,o)=>{return 0<t&&(t+=s),t+=Math.max(o.getSum()*e,i.options.minLinkWidth||0)},0);return{top:0,center:.5,bottom:1}[i.options.nodeAlignment||"center"]*((i.chart.plotSizeY||0)-t)}left(e){const i=this.series,t=i.chart,s=i.options.equalNodes,n=t.inverted?t.plotHeight:t.plotWidth,r=i.nodePadding,o=this.points.reduce((t,o)=>{return 0<t&&(t+=r),t+=s?n/o.series.nodes.length-r:Math.max(o.getSum()*e,i.options.minLinkWidth||0)},0);return((t.plotSizeX||0)-Math.round(o))/2}sum(){return this.points.reduce((t,o)=>t+o.getSum(),0)}offset(o,e){const i=this.points,s=this.series,n=s.nodePadding;let r=0,l;if(s.is("organization")&&o.hangsFrom)return{absoluteTop:o.hangsFrom.nodeY};for(let t=0;t<i.length;t++){var a=i[t].getSum(),d=Math.max(a*e,s.options.minLinkWidth||0),h=o.options[s.chart.inverted?"offsetHorizontal":"offsetVertical"],p=o.options.offset||0;if(l=a?d+n:0,i[t]===o)return{relativeTop:r+(c(h)?u(h,d):u(p,l))};r+=l}}}t.SankeyColumnAdditions=i}return o}),o(t,"Series/TreeUtilities.js",[t["Core/Color/Color.js"],t["Core/Utilities.js"]],function(v,t){const{extend:m,isArray:a,isNumber:d,isObject:h,merge:p,pick:k,relativeLength:s}=t;return{getColor:function(t,o){const e=o.index,i=o.mapOptionsToLevel,s=o.parentColor,n=o.parentColorIndex,r=o.series,l=o.colors,a=o.siblings,d=r.points,h=r.chart.options.chart;let p,c,u,m,f,g;var y;return t&&(p=d[t.i],c=i[t.level]||{},p&&c.colorByPoint&&(m=p.index%(l?l.length:h.colorCount),u=l&&l[m]),r.chart.styledMode||(f=k(p&&p.options.color,c&&c.color,u,s&&(t=s,(y=c&&c.colorVariation)&&"brightness"===y.key&&e&&a?v.parse(t).brighten(y.to*(e/a)).get():t),r.color)),g=k(p&&p.options.colorIndex,c&&c.colorIndex,m,n,o.colorIndex)),{color:f,colorIndex:g}},getLevelOptions:function(t){const o={};let n,e,i,r,s,l;if(h(t))for(r=d(t.from)?t.from:1,l=t.levels,e={},n=h(t.defaults)?t.defaults:{},a(l)&&(e=l.reduce((t,o)=>{let e,i,s;return h(o)&&d(o.level)&&(s=p({},o),i=k(s.levelIsConstant,n.levelIsConstant),delete s.levelIsConstant,delete s.level,e=o.level+(i?0:r-1),h(t[e])?p(!0,t[e],s):t[e]=s),t},{})),s=d(t.to)?t.to:1,i=0;i<=s;i++)o[i]=p({},n,h(e[i])?e[i]:{});return o},getNodeWidth:function(t,o){var{chart:t,options:e}=t,{nodeDistance:e=0,nodeWidth:i=0}=e,{plotSizeX:t=1}=t;return"auto"!==i?s(i,t):"string"==typeof e&&/%$/.test(e)?t/(o+parseFloat(e)/100*(o-1)):(i=Number(e),(t+i)/(o||1)-i)},setTreeValues:function i(s,n){const t=n.before,o=n.idRoot,e=n.mapIdToNode,r=e[o],l=!1!==n.levelIsConstant,a=n.points,d=a[s.i],h=d&&d.options||{},p=[];let c=0;s.levelDynamic=s.level-(l?0:r.level),s.name=k(d&&d.name,""),s.visible=o===s.id||!0===n.visible,(s="function"==typeof t?t(s,n):s).children.forEach((t,o)=>{var e=m({},n);m(e,{index:o,siblings:s.children.length,visible:s.visible}),t=i(t,e),p.push(t),t.visible&&(c+=t.val)});var u=k(h.value,c);return s.visible=0<=u&&(0<c||s.visible),s.children=p,s.childrenTotal=c,s.isLeaf=s.visible&&!c,s.val=u,s},updateRootId:function(t){let o,e;return h(t)&&(e=h(t.options)?t.options:{},o=k(t.rootNode,e.rootId,""),h(t.userOptions)&&(t.userOptions.rootId=o),t.rootNode=o),o}}}),o(t,"Series/Sankey/SankeySeries.js",[t["Core/Globals.js"],t["Series/NodesComposition.js"],t["Series/Sankey/SankeyPoint.js"],t["Series/Sankey/SankeySeriesDefaults.js"],t["Core/Series/SeriesRegistry.js"],t["Series/Sankey/SankeyColumnComposition.js"],t["Core/Color/Color.js"],t["Series/TreeUtilities.js"],t["Core/Utilities.js"]],function(t,o,e,i,s,n,d,r,l){const{column:a,line:h}=s.seriesTypes,I=d["parse"],{getLevelOptions:p,getNodeWidth:c}=r,{clamp:u,extend:m,isObject:f,merge:g,pick:Y,relativeLength:y,stableSort:v}=l;class k extends a{static getDLOptions(t){var o=f(t.optionsPoint)?t.optionsPoint.dataLabels:{},t=f(t.level)?t.level.dataLabels:{};return g({style:{}},t,o)}createNodeColumns(){const o=[];for(const t of this.nodes)t.setNodeColumn(),o[t.column]||(o[t.column]=n.compose([],this)),o[t.column].push(t);for(let t=0;t<o.length;t++)void 0===o[t]&&(o[t]=n.compose([],this));return o}order(t,o){if(void 0===t.level){t.level=o;for(const e of t.linksFrom)e.toNode&&this.order(e.toNode,o+1)}}generatePoints(){if(o.generatePoints.apply(this,arguments),this.orderNodes){for(const t of this.nodes)0===t.linksTo.length&&this.order(t,0);v(this.nodes,(t,o)=>t.level-o.level)}}getNodePadding(){let t=this.options.nodePadding||0;var o;return t=this.nodeColumns&&(o=this.nodeColumns.reduce((t,o)=>Math.max(t,o.length),0))*t>this.chart.plotSizeY?this.chart.plotSizeY/o:t}hasData(){return!!this.processedXData.length}pointAttribs(t,o){if(!t)return{};const e=this,i=(t.isNode?t:t.fromNode).level,s=e.mapOptionsToLevel[i||0]||{},n=t.options,r=s.states&&s.states[o||""]||{},l=["colorByPoint","borderColor","borderWidth","linkOpacity","opacity"].reduce((t,o)=>(t[o]=Y(r[o],n[o],s[o],e.options[o]),t),{}),a=Y(r.color,n.color,(l.colorByPoint?t:s).color);return t.isNode?{fill:a,stroke:l.borderColor,"stroke-width":l.borderWidth,opacity:l.opacity}:{fill:d.parse(a).setOpacity(l.linkOpacity).get()}}drawTracker(){a.prototype.drawTracker.call(this,this.points),a.prototype.drawTracker.call(this,this.nodes)}drawPoints(){a.prototype.drawPoints.call(this,this.points),a.prototype.drawPoints.call(this,this.nodes)}drawDataLabels(){a.prototype.drawDataLabels.call(this,this.points),a.prototype.drawDataLabels.call(this,this.nodes)}translate(){this.processedXData||this.processData(),this.generatePoints(),this.nodeColumns=this.createNodeColumns();const e=this,t=this.chart,o=this.options,i=this.nodeColumns,s=i.length;this.nodeWidth=c(this,s),this.nodePadding=this.getNodePadding(),this.translationFactor=i.reduce((t,o)=>Math.min(t,o.sankeyColumn.getTranslationFactor(e)),1/0),this.colDistance=(t.plotSizeX-this.nodeWidth-o.borderWidth)/Math.max(1,i.length-1),e.mapOptionsToLevel=p({from:1,levels:o.levels,to:i.length-1,defaults:{borderColor:o.borderColor,borderRadius:o.borderRadius,borderWidth:o.borderWidth,color:e.color,colorByPoint:o.colorByPoint,levelIsConstant:!0,linkColor:o.linkColor,linkLineWidth:o.linkLineWidth,linkOpacity:o.linkOpacity,states:o.states}});for(const n of i)for(const r of n)e.translateNode(r,n);for(const l of this.nodes)for(const a of l.linksFrom)(a.weight||a.isNull)&&a.to&&(e.translateLink(a),a.allowShadow=!1)}translateLink(e){var t,o,i,s,n,r,l,a,d,h,p,c,u,m,f,g,y,v,k=(t,o)=>{o=t.offset(e,o)*x;return Math.min(t.nodeY+o,t.nodeY+(t.shapeArgs&&t.shapeArgs.height||0)-M)};const C=e.fromNode,S=e.toNode,N=this.chart,b=N["inverted"],x=this.translationFactor,L=this.options,T=Y(e.linkColorMode,L.linkColorMode),P=(N.inverted?-this.colDistance:this.colDistance)*L.curveFactor,w=C.nodeX,j=S.nodeX,O=e.outgoing;let M=Math.max(e.weight*x,this.options.minLinkWidth),W=k(C,"linksFrom"),F=k(S,"linksTo"),D=this.nodeWidth,z=j>w+D;N.inverted&&(W=N.plotSizeY-W,F=(N.plotSizeY||0)-F,D=-D,M=-M,z=j<w),e.shapeType="path",e.linkBase=[W,W+M,F,F+M],z&&"number"==typeof F?e.shapeArgs={d:[["M",w+D,W],["C",w+D+P,W,j-P,F,j,F],["L",j+(O?D:0),F+M/2],["L",j,F+M],["C",j-P,F+M,w+D+P,W+M,w+D,W+M],["Z"]]}:"number"==typeof F&&(k=N.plotHeight-W-M,t=j-20-M,o=j-20,n=(s=(i=w+D)+20)+M,d=(a=(k=(l=(r=(y=W)+M)+20)+k)+20)+M,c=(p=(h=F)+M)+20,v=r-.7*M,u=a+.7*M,m=p-.7*M,f=j-.7*M,g=i+.7*M,e.shapeArgs={d:[["M",i,y],["C",g,y,n,v,n,l],["L",n,k],["C",n,u,g,d,i,d],["L",j,d],["C",f,d,t,u,t,k],["L",t,c],["C",t,m,f,h,j,h],["L",j,p],["C",o,p,o,p,o,c],["L",o,k],["C",o,a,o,a,j,a],["L",i,a],["C",s,a,s,a,s,k],["L",s,l],["C",s,r,s,r,i,r],["Z"]]}),e.dlBox={x:w+(j-w+D)/2,y:W+(F-W)/2,height:M,width:0},e.tooltipPos=N.inverted?[N.plotSizeY-e.dlBox.y-M/2,N.plotSizeX-e.dlBox.x]:[e.dlBox.x,e.dlBox.y+M/2],e.y=e.plotY=1,e.x=e.plotX=1,e.options.color||("from"===T?e.color=C.color:"to"===T?e.color=S.color:"gradient"===T&&(y=I(C.color).get(),v=I(S.color).get(),e.color={linearGradient:{x1:1,x2:0,y1:0,y2:0},stops:[[0,b?y:v],[1,b?v:y]]}))}translateNode(s,n){var t=this.translationFactor,r=this.chart,l=this.options,{borderRadius:a,borderWidth:d=0}=l,o=s.getSum(),h=Math.max(Math.round(o*t),this.options.minLinkWidth),p=Math.round(this.nodeWidth),e=Math.round(d)%2/2,c=n.sankeyColumn.offset(s,t),n=Math.floor(Y(c.absoluteTop,n.sankeyColumn.top(t)+c.relativeTop))+e,t=Math.floor(this.colDistance*s.column+d/2)+y(s.options[r.inverted?"offsetVertical":"offsetHorizontal"]||0,p)+e,c=r.inverted?r.plotSizeX-t:t;if(s.sum=o){s.shapeType="roundedRect";let t=s.nodeX=c,o=s.nodeY=n,e=s.options.width||l.width||p,i=s.options.height||l.height||h;d=u(y("object"==typeof a?a.radius:a||0,e),0,h/2);r.inverted&&(t=c-p,o=r.plotSizeY-n-h,e=s.options.height||l.height||p,i=s.options.width||l.width||h),s.dlOptions=k.getDLOptions({level:this.mapOptionsToLevel[s.level],optionsPoint:s.options}),s.plotX=1,s.plotY=1,s.tooltipPos=r.inverted?[r.plotSizeY-o-i/2,r.plotSizeX-t-e/2]:[t+e/2,o+i/2],s.shapeArgs={x:t,y:o,width:e,height:i,r:d,display:s.hasShape()?"":"none"}}else s.dlOptions={enabled:!1}}}return k.defaultOptions=g(a.defaultOptions,i),o.compose(e,k),m(k.prototype,{animate:h.prototype.animate,createNode:o.createNode,forceDL:!0,invertible:!0,isCartesian:!1,orderNodes:!0,noSharedTooltip:!0,pointArrayMap:["from","to","weight"],pointClass:e,searchPoint:t.noop}),s.registerSeriesType("sankey",k),k}),o(t,"masters/modules/sankey.src.js",[t["Core/Globals.js"]],function(t){return t})});