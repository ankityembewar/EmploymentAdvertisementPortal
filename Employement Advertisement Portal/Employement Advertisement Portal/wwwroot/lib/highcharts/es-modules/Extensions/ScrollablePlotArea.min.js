"use strict";import A from"../Core/Animation/AnimationUtilities.js";const stop=A["stop"];import H from"../Core/Globals.js";const composed=H["composed"];import RendererRegistry from"../Core/Renderer/RendererRegistry.js";import U from"../Core/Utilities.js";const{addEvent,createElement,css,defined,merge,pushUnique}=U;function onChartRender(){let e=this.scrollablePlotArea;!this.scrollablePixelsX&&!this.scrollablePixelsY||e||(this.scrollablePlotArea=e=new ScrollablePlotArea(this)),e?.applyFixed()}function markDirty(){this.chart.scrollablePlotArea&&(this.chart.scrollablePlotArea.isDirty=!0)}class ScrollablePlotArea{static compose(e,t,i){pushUnique(composed,this.compose)&&(addEvent(e,"afterInit",markDirty),addEvent(t,"afterSetChartSize",e=>this.afterSetSize(e.target,e)),addEvent(t,"render",onChartRender),addEvent(i,"show",markDirty))}static afterSetSize(e,t){const{minWidth:i,minHeight:r}=e.options.chart.scrollablePlotArea||{},{clipBox:o,plotBox:s,inverted:a,renderer:l}=e;let h,n,c;if(!l.forExport&&(i?(e.scrollablePixelsX=h=Math.max(0,i-e.chartWidth),h&&(e.scrollablePlotBox=merge(e.plotBox),s.width=e.plotWidth+=h,o[a?"height":"width"]+=h,c=!0)):r&&(e.scrollablePixelsY=n=Math.max(0,r-e.chartHeight),defined(n)&&(e.scrollablePlotBox=merge(e.plotBox),s.height=e.plotHeight+=n,o[a?"width":"height"]+=n,c=!1)),defined(c)&&!t.skipAxes))for(const d of e.axes)d.horiz===c&&(d.setAxisSize(),d.setAxisTranslation())}constructor(i){const e=i.options.chart,t=RendererRegistry.getRendererType(),r=e.scrollablePlotArea||{},o=this.moveFixedElements.bind(this),s={WebkitOverflowScrolling:"touch",overflowX:"hidden",overflowY:"hidden"},a=(i.scrollablePixelsX&&(s.overflowX="auto"),i.scrollablePixelsY&&(s.overflowY="auto"),this.chart=i,this.parentDiv=createElement("div",{className:"highcharts-scrolling-parent"},{position:"relative"},i.renderTo)),l=this.scrollingContainer=createElement("div",{className:"highcharts-scrolling"},s,a),h=this.innerContainer=createElement("div",{className:"highcharts-inner-container"},void 0,l),n=this.fixedDiv=createElement("div",{className:"highcharts-fixed"},{position:"absolute",overflow:"hidden",pointerEvents:"none",zIndex:(e.style?.zIndex||0)+2,top:0},void 0,!0),c=this.fixedRenderer=new t(n,i.chartWidth,i.chartHeight,e.style);this.mask=c.path().attr({fill:e.backgroundColor||"#fff","fill-opacity":r.opacity??.85,zIndex:-1}).addClass("highcharts-scrollable-mask").add(),l.parentNode.insertBefore(n,l),css(i.renderTo,{overflow:"visible"}),addEvent(i,"afterShowResetZoom",o),addEvent(i,"afterApplyDrilldown",o),addEvent(i,"afterLayOutTitles",o);let d;addEvent(l,"scroll",()=>{const{pointer:e,hoverPoint:t}=i;e&&(delete e.chartPosition,t&&(d=t),e.runPointActions(void 0,d,!0))}),h.appendChild(i.container)}applyFixed(){const{chart:e,fixedRenderer:t,isDirty:i,scrollingContainer:r}=this,{axisOffset:o,chartWidth:s,chartHeight:a,container:l,plotHeight:h,plotLeft:n,plotTop:c,plotWidth:d,scrollablePixelsX:p=0,scrollablePixelsY:g=0}=e,x=e.options.chart,f=x.scrollablePlotArea||{},{scrollPositionX:m=0,scrollPositionY:b=0}=f,v=s+p,u=a+g;t.setSize(s,a),(i??!0)&&(this.isDirty=!1,this.moveFixedElements()),stop(e.container),css(l,{width:v+"px",height:u+"px"}),e.renderer.boxWrapper.attr({width:v,height:u,viewBox:[0,0,v,u].join(" ")}),e.chartBackground?.attr({width:v,height:u}),css(r,{width:s+"px",height:a+"px"}),defined(i)||(r.scrollLeft=p*m,r.scrollTop=g*b);var P=c-o[0]-1,y=n-o[3]-1,w=c+h+o[2]+1,E=n+d+o[1]+1,A=n+d-p,S=c+h-g;let L=[["M",0,0]];p?L=[["M",0,P],["L",n-1,P],["L",n-1,w],["L",0,w],["Z"],["M",A,P],["L",s,P],["L",s,w],["L",A,w],["Z"]]:g&&(L=[["M",y,0],["L",y,c-1],["L",E,c-1],["L",E,0],["Z"],["M",y,S],["L",y,a],["L",E,a],["L",E,S],["Z"]]),"adjustHeight"!==e.redrawTrigger&&this.mask.attr({d:L})}moveFixedElements(){const{container:e,inverted:t,scrollablePixelsX:i,scrollablePixelsY:r}=this.chart,o=this.fixedRenderer,s=[".highcharts-breadcrumbs-group",".highcharts-contextbutton",".highcharts-caption",".highcharts-credits",".highcharts-legend",".highcharts-legend-checkbox",".highcharts-navigator-series",".highcharts-navigator-xaxis",".highcharts-navigator-yaxis",".highcharts-navigator",".highcharts-reset-zoom",".highcharts-drillup-button",".highcharts-scrollbar",".highcharts-subtitle",".highcharts-title"];let a;i&&!t?a=".highcharts-yaxis":i&&t||r&&!t?a=".highcharts-xaxis":r&&t&&(a=".highcharts-yaxis"),a&&s.push(a+":not(.highcharts-radial-axis)",a+"-labels:not(.highcharts-radial-axis-labels)");for(const l of s)[].forEach.call(e.querySelectorAll(l),e=>{(e.namespaceURI===o.SVG_NS?o.box:o.box.parentNode).appendChild(e),e.style.pointerEvents="auto"})}}export default ScrollablePlotArea;