"use strict";import U from"../Core/Utilities.js";const{addEvent,fireEvent,objectEach,pick}=U;function chartHideOverlappingLabels(a){var i,l,o=a.length;let e,n,r,s,c,t=!1;for(let t=0;t<o;t++)(e=a[t])&&(e.oldOpacity=e.opacity,e.newOpacity=1,e.absoluteBox=function(t){var e,a,i;if(t&&(!t.alignAttr||t.placed))return e=!t.box&&t.padding||0,a=t.alignAttr||{x:t.attr("x"),y:t.attr("y")},i=t.getBBox(),t.width=i.width,t.height=i.height,{x:a.x+(t.parentGroup?.translateX||0)+e,y:a.y+(t.parentGroup?.translateY||0)+e,width:(t.width||0)-2*e,height:(t.height||0)-2*e}}(e));a.sort((t,e)=>(e.labelrank||0)-(t.labelrank||0));for(let e=0;e<o;++e){s=(n=a[e])&&n.absoluteBox;for(let t=e+1;t<o;++t)r=a[t],c=r&&r.absoluteBox,s&&c&&n!==r&&0!==n.newOpacity&&0!==r.newOpacity&&"hidden"!==n.visibility&&"hidden"!==r.visibility&&(i=s,(l=c).x>=i.x+i.width||l.x+l.width<=i.x||l.y>=i.y+i.height||l.y+l.height<=i.y||((n.labelrank<r.labelrank?n:r).newOpacity=0))}for(const e of a)hideOrShow(e,this)&&(t=!0);t&&fireEvent(this,"afterHideAllOverlappingLabels")}function compose(t){const e=t.prototype;e.hideOverlappingLabels||(e.hideOverlappingLabels=chartHideOverlappingLabels,addEvent(t,"render",onChartRender))}function hideOrShow(t,e){let a,i=!1;return t&&(a=t.newOpacity,t.oldOpacity!==a&&(t.hasClass("highcharts-data-label")?(t[a?"removeClass":"addClass"]("highcharts-data-label-hidden"),i=!0,t[t.isOld?"animate":"attr"]({opacity:a},void 0,function(){e.styledMode||t.css({pointerEvents:a?"auto":"none"})}),fireEvent(e,"afterHideOverlappingLabel")):t.attr({opacity:a})),t.isOld=!0),i}function onChartRender(){const i=this;let l=[];for(const e of i.labelCollectors||[])l=l.concat(e());for(const a of i.yAxis||[])a.stacking&&a.options.stackLabels&&!a.options.stackLabels.allowOverlap&&objectEach(a.stacking.stacks,t=>{objectEach(t,t=>{t.label&&l.push(t.label)})});for(const o of i.series||[]){var t;o.visible&&o.hasDataLabels?.()&&((t=t=>{for(const a of t)a.visible&&(a.dataLabels||[]).forEach(t=>{var e=t.options||{};t.labelrank=pick(e.labelrank,a.labelrank,a.shapeArgs?.height),e.allowOverlap??0<Number(e.distance)?(t.oldOpacity=t.opacity,t.newOpacity=1,hideOrShow(t,i)):l.push(t)})})(o.nodes||[]),t(o.points))}this.hideOverlappingLabels(l)}const OverlappingDataLabels={compose:compose};export default OverlappingDataLabels;