"use strict";import DataLabel from"../../Core/Series/DataLabel.js";import H from"../../Core/Globals.js";const{composed,noop}=H;import R from"../../Core/Renderer/RendererUtilities.js";const distribute=R["distribute"];import SeriesRegistry from"../../Core/Series/SeriesRegistry.js";const Series=SeriesRegistry["series"];import U from"../../Core/Utilities.js";const{arrayMax,clamp,defined,pick,pushUnique,relativeLength}=U;var ColumnDataLabel;!function(t){const e={radialDistributionY:function(t,a){return(a.dataLabelPosition?.top||0)+t.distributeBox.pos},radialDistributionX:function(t,a,e,i,o){var s=o.dataLabelPosition;return t.getX(e<(s?.top||0)+2||e>(s?.bottom||0)-2?i:e,a.half,a,o)},justify:function(t,a,e,i){return i[0]+(t.half?-1:1)*(e+(a.dataLabelPosition?.distance||0))},alignToPlotEdges:function(t,a,e,i){t=t.getBBox().width;return a?t+i:e-t-i},alignToConnectors:function(t,a,e,i){let o=0,s;return t.forEach(function(t){(s=t.dataLabel.getBBox().width)>o&&(o=s)}),a?o+i:e-o-i}};function i(t,a){var{center:e,options:i}=this,o=e[2]/2,s=t.angle||0,r=Math.cos(s),s=Math.sin(s),n=e[0]+r*o,e=e[1]+s*o,o=Math.min((i.slicedOffset||0)+(i.borderWidth||0),a/5);return{natural:{x:n+r*a,y:e+s*a},computed:{},alignment:a<0?"center":t.half?"right":"left",connectorPosition:{breakAt:{x:n+r*o,y:e+s*o},touchingSliceAt:{x:n,y:e}},distance:a}}function o(){const u=this,t=u.points,r=u.chart,f=r.plotWidth,p=r.plotHeight,m=r.plotLeft,s=Math.round(r.chartWidth/3),g=u.center,L=g[2]/2,n=g[1],l=[[],[]],x=[0,0,0,0],y=u.dataLabelPositioners;let d,M,v,w=0;u.visible&&u.hasDataLabels?.()&&(t.forEach(t=>{(t.dataLabels||[]).forEach(t=>{t.shortened&&(t.attr({width:"auto"}).css({width:"auto",textOverflow:"clip"}),t.shortened=!1)})}),Series.prototype.drawDataLabels.apply(u),t.forEach(o=>{(o.dataLabels||[]).forEach((t,a)=>{var e=g[2]/2,i=t.options,e=relativeLength(i?.distance||0,e);0===a&&l[o.half].push(o),defined(i?.style?.width)||t.getBBox().width>s&&(t.css({width:Math.round(.7*s)+"px"}),t.shortened=!0),t.dataLabelPosition=this.getDataLabelPosition(o,e),w=Math.max(w,e)})}),l.forEach((h,c)=>{const t=h.length,b=[];let a,e,i=0,o;t&&(u.sortByAngle(h,c-.5),0<w&&(a=Math.max(0,n-L-w),e=Math.min(n+L+w,r.plotHeight),h.forEach(e=>{(e.dataLabels||[]).forEach(t=>{const a=t.dataLabelPosition;a&&0<a.distance&&(a.top=Math.max(0,n-L-a.distance),a.bottom=Math.min(n+L+a.distance,r.plotHeight),i=t.getBBox().height||21,e.distributeBox={target:(t.dataLabelPosition?.natural.y||0)-a.top+i/2,size:i,rank:e.y},b.push(e.distributeBox))})}),o=e+i-a,distribute(b,o,o/5)),h.forEach(d=>{(d.dataLabels||[]).forEach(a=>{const t=a.options||{},e=d.distributeBox,i=a.dataLabelPosition,o=i?.natural.y||0,s=t.connectorPadding||0;let r=0,n=o,l="inherit";if(i){if(b&&defined(e)&&0<i.distance&&(void 0===e.pos?l="hidden":(v=e.size,n=y.radialDistributionY(d,a))),t.justify)r=y.justify(d,a,L,g);else switch(t.alignTo){case"connectors":r=y.alignToConnectors(h,c,f,m);break;case"plotEdges":r=y.alignToPlotEdges(a,c,f,m);break;default:r=y.radialDistributionX(u,d,n,o,a)}if(i.attribs={visibility:l,align:i.alignment},i.posAttribs={x:r+(t.x||0)+({left:s,right:-s}[i.alignment]||0),y:n+(t.y||0)-a.getBBox().height/2},i.computed.x=r,i.computed.y=n,pick(t.crop,!0)){M=a.getBBox().width;let t;r-M<s&&1===c?(t=Math.round(M-r+s),x[3]=Math.max(t,x[3])):r+M>f-s&&0===c&&(t=Math.round(r+M-f+s),x[1]=Math.max(t,x[1])),n-v/2<0?x[0]=Math.max(Math.round(-n+v/2),x[0]):n+v/2>p&&(x[2]=Math.max(Math.round(n+v/2-p),x[2])),i.sideOverflow=t}}})}))}),0!==arrayMax(x)&&!this.verifyDataLabelOverflow(x)||(this.placeDataLabels(),this.points.forEach(s=>{(s.dataLabels||[]).forEach(t=>{var a,{connectorColor:e,connectorWidth:i=1}=t.options||{},o=t.dataLabelPosition;i&&(d=t.connector,o&&0<o.distance?(a=!d,d||(t.connector=d=r.renderer.path().addClass("highcharts-data-label-connector  highcharts-color-"+s.colorIndex+(s.className?" "+s.className:"")).add(u.dataLabelsGroup)),r.styledMode||d.attr({"stroke-width":i,stroke:e||s.color||"#666666"}),d[a?"attr":"animate"]({d:s.getConnectorPath(t)}),d.attr({visibility:o.attribs?.visibility})):d&&(t.connector=d.destroy()))})})))}function s(){this.points.forEach(t=>{(t.dataLabels||[]).forEach(t=>{var a=t.dataLabelPosition;a?(a.sideOverflow&&(t.css({width:Math.max(t.getBBox().width-a.sideOverflow,0)+"px",textOverflow:(t.options?.style||{}).textOverflow||"ellipsis"}),t.shortened=!0),t.attr(a.attribs),t[t.moved?"animate":"attr"](a.posAttribs),t.moved=!0):t&&t.attr({y:-9999})}),delete t.distributeBox},this)}function r(t){const a=this.center,e=this.options,i=e.center,o=e.minSize||80;let s=o,r=null!==e.size;return r||(null!==i[0]?s=Math.max(a[2]-Math.max(t[1],t[3]),o):(s=Math.max(a[2]-t[1]-t[3],o),a[0]+=(t[3]-t[1])/2),null!==i[1]?s=clamp(s,o,a[2]-Math.max(t[0],t[2])):(s=clamp(s,o,a[2]-t[0]-t[2]),a[1]+=(t[0]-t[2])/2),s<a[2]?(a[2]=s,a[3]=Math.min(e.thickness?Math.max(0,s-2*e.thickness):Math.max(0,relativeLength(e.innerSize||0,s)),s),this.translate(a),this.drawDataLabels&&this.drawDataLabels()):r=!0),r}t.compose=function(t){if(DataLabel.compose(Series),pushUnique(composed,"PieDataLabel")){const a=t.prototype;a.dataLabelPositioners=e,a.alignDataLabel=noop,a.drawDataLabels=o,a.getDataLabelPosition=i,a.placeDataLabels=s,a.verifyDataLabelOverflow=r}}}(ColumnDataLabel=ColumnDataLabel||{});export default ColumnDataLabel;